pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Building the application l Mavgn'
            }
        }

        stage('Unit and Integration Tests') {
            steps {
                echo 'Running unit and integration tests l JUnit'

                script {
                    def testResult = currentBuild.result ?: 'SUCCESS'
                    def emailBody = "Unit and Integration Test Results:\n\nBuild Result: ${testResult}\n\n"
                    emailext body: emailBody,
                            subject: "Test Stage Status: ${testResult}",
                            to: 'henry.and.ruth@gmail.com',
                            attachLog: true
                }
            }
        }

        stage('Code Analysis') {
            steps {
                echo 'Performing code analysis l SonarQube'
            }
        }

        stage('Security Scan') {
            steps {
                echo 'Performing security scan l Snyk'

                script {
                    def securityScanResult = currentBuild.result ?: 'SUCCESS'
                    def emailBody = "Security Scan Results:\n\nBuild Result: ${securityScanResult}\n\n"
                    emailext body: emailBody,
                            subject: "Security Scan Status: ${securityScanResult}",
                            to: 'henry.and.ruth@gmail.com',
                            attachLog: true 
                }
            }
        }

        stage('Deploy to Staging') {
            steps {
                echo 'Deploying to Staging l WAR'
            }
        }

        stage('Integration Tests on Staging') {
            steps {
                echo 'Running integration tests on Staging l PStaging'
            }
        }

        stage('Deploy to Production') {
            steps {
                echo 'Deploying to Production...'
            }
        }
    }
}
